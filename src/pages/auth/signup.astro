---
import BaseLayout from '../../layouts/BaseLayout.astro';
---

<BaseLayout title="회원가입">
  <section class="container-narrow py-16 md:py-24">
    <div class="max-w-md mx-auto">
      <h1 class="text-3xl font-serif font-bold text-primary text-center mb-8">
        회원가입
      </h1>

      <div id="error-message" class="hidden mb-4 p-4 bg-red-50 border border-red-200 text-red-600 rounded-lg text-sm">
      </div>

      <div id="success-message" class="hidden mb-4 p-4 bg-green-50 border border-green-200 text-green-600 rounded-lg text-sm">
        회원가입이 완료되었습니다! 이메일을 확인해주세요.
      </div>

      <form id="signup-form" class="space-y-6">
        <div>
          <label for="name" class="block text-sm font-medium text-primary mb-2">
            이름
          </label>
          <input
            type="text"
            id="name"
            name="name"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent/20 focus:border-accent outline-none transition-colors"
            placeholder="홍길동"
          />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium text-primary mb-2">
            이메일
          </label>
          <input
            type="email"
            id="email"
            name="email"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent/20 focus:border-accent outline-none transition-colors"
            placeholder="your@email.com"
          />
        </div>

        <div>
          <label for="password" class="block text-sm font-medium text-primary mb-2">
            비밀번호
          </label>
          <input
            type="password"
            id="password"
            name="password"
            required
            minlength="6"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent/20 focus:border-accent outline-none transition-colors"
            placeholder="6자 이상 입력"
          />
        </div>

        <div>
          <label for="password-confirm" class="block text-sm font-medium text-primary mb-2">
            비밀번호 확인
          </label>
          <input
            type="password"
            id="password-confirm"
            name="password-confirm"
            required
            minlength="6"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-accent/20 focus:border-accent outline-none transition-colors"
            placeholder="비밀번호 재입력"
          />
        </div>

        <button
          type="submit"
          id="submit-btn"
          class="w-full py-3 bg-primary text-white rounded-lg font-medium hover:bg-accent transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
        >
          회원가입
        </button>
      </form>

      <p class="mt-6 text-center text-secondary">
        이미 계정이 있으신가요?
        <a href="/auth/login" class="text-accent hover:underline">로그인</a>
      </p>
    </div>
  </section>
</BaseLayout>

<script>
  import { signUp } from '../../lib/supabase';

  const form = document.getElementById('signup-form') as HTMLFormElement;
  const errorMessage = document.getElementById('error-message') as HTMLDivElement;
  const successMessage = document.getElementById('success-message') as HTMLDivElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorMessage.classList.add('hidden');
    successMessage.classList.add('hidden');
    submitBtn.disabled = true;
    submitBtn.textContent = '가입 중...';

    const formData = new FormData(form);
    const name = formData.get('name') as string;
    const email = formData.get('email') as string;
    const password = formData.get('password') as string;
    const passwordConfirm = formData.get('password-confirm') as string;

    if (password !== passwordConfirm) {
      errorMessage.textContent = '비밀번호가 일치하지 않습니다.';
      errorMessage.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = '회원가입';
      return;
    }

    const { data, error } = await signUp(email, password, name);

    if (error) {
      errorMessage.textContent = error.message;
      errorMessage.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = '회원가입';
      return;
    }

    // Show success message
    form.classList.add('hidden');
    successMessage.classList.remove('hidden');
  });
</script>
